# Analysis configuration for GNT project

# Analysis types and configurations
analyses:
  
  # Online RLS regression analysis
  online_rls:
    description: "Online Recursive Least Squares with cluster-robust standard errors"
    module: "gnt.analysis.models.online_RLS"
    class: "OnlineRLS"
    
    # Default settings
    defaults:
      n_workers: 8
      add_intercept: true
      alpha: 0.001
      forget_factor: 1.0
      chunk_size: 20000
      show_progress: true
      verbose: false
      cluster_type: "two_way"
    
    # Predefined model specifications
    specifications:

      ### First stage testing:

      ntlharm_regfav_twfe_hdi:
        description: "TWFE MODIS NTLHARM analysis in HDI groups"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "ntl_harm_twoway_demeaned ~ reg_fav_twoway_demeaned:HDI_ME + reg_fav_twoway_demeaned:HDI_HI + reg_fav_twoway_demeaned:HDI_VH"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      viirs_regfav_twfe_hdi:
        description: "TWFE MODIS NTLHARM analysis in HDI groups"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "viirs_annual_twoway_demeaned ~ reg_fav_twoway_demeaned:HDI_ME + reg_fav_twoway_demeaned:HDI_HI + reg_fav_twoway_demeaned:HDI_VH"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      ### Pooled Models:
      
      modis_ntlharm_pooled:
        description: "Pooled MODIS NTLHARM analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median ~ ntl_harm"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      modis_ntlharm_pooled:
        description: "Pooled MODIS VIIRS analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median ~ viirs_annual"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      ### UFE Models:

      modis_ntlharm_ufe:
        description: "UFE MODIS NTLHARM analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_unit_demeaned ~ ntl_harm_unit_demeaned - 1"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      modis_viirs_ufe:
        description: "UFE MODIS VIIRS analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_unit_demeaned ~ viirs_annual_unit_demeaned - 1"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      ### TWFE Models:

      modis_ntlharm_twfe:
        description: "TWFE MODIS NTLHARM analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_twoway_demeaned ~ ntl_harm_twoway_demeaned - 1"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      modis_viirs_twfe:
        description: "Demeaned MODIS VIIRS analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_twoway_demeaned ~ viirs_annual_twoway_demeaned - 1"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      ## HDI split

      modis_ntlharm_twfe_hdi:
        description: "TWFE MODIS NTLHARM analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_twoway_demeaned ~ ntl_harm_twoway_demeaned:HDI_ME + ntl_harm_twoway_demeaned:HDI_HI + ntl_harm_twoway_demeaned:HDI_VH"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      modis_viirs_twfe_hdi:
        description: "Demeaned MODIS VIIRS analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_twoway_demeaned ~ viirs_annual_twoway_demeaned:HDI_ME + viirs_annual_twoway_demeaned:HDI_HI + viirs_annual_twoway_demeaned:HDI_VH"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      ## Experimental

      modis_ntlharm_twfe_quadratic:
        description: "TWFE MODIS NTLHARM with quadratic term"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_twoway_demeaned ~ ntl_harm_twoway_demeaned + I(ntl_harm_twoway_demeaned^2) - 1"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      ## DEBUG

      debug_modis_viirs_twfe_hdi:
        description: "Demeaned MODIS VIIRS analysis"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis_subset.parquet"
        formula: "median_twoway_demeaned ~ viirs_annual_twoway_demeaned:HDI_ME + viirs_annual_twoway_demeaned:HDI_HI"
        cluster1_col: "subdivisions"
        cluster2_col: "year"
        module: "gnt.analysis.streamreg"
        class: "ols"

  # Two-Stage Least Squares analysis
  online_2sls:
    description: "Online Two-Stage Least Squares with cluster-robust standard errors"
    module: "gnt.analysis.models.online_RLS"
    class: "Online2SLS"
    
    defaults:
      n_workers: 8
      add_intercept: true
      alpha: 0.001
      forget_factor: 1.0
      chunk_size: 20000
      show_progress: true
      verbose: false
      cluster_type: "two_way"
      weak_instrument_threshold: 10.0
    
    specifications:
      
      ### TWFE Models:

      modis_ntlharm_regfav_twfe:
        description: "2SLS TWFE: Growth effect on temperature using regional favoritism as instrument"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_twoway_demeaned ~ ntl_harm_twoway_demeaned | reg_fav_twoway_demeaned"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      modis_viirs_regfav_twfe:
        description: "2SLS TWFE: Growth effect on temperature using regional favoritism as instrument"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_twoway_demeaned ~ viirs_annual_twoway_demeaned | reg_fav_twoway_demeaned"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      ## HDI split

      modis_ntlharm_regfav_pooled_hdi:
        description: "2SLS: Growth effect on temperature interacted with HDI classes using regional favoritism as instrument"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis.parquet"
        formula: "median_twoway_demeaned ~ ntl_harm_twoway_demeaned:HDI_ME + ntl_harm_twoway_demeaned:HDI_HI + ntl_harm_twoway_demeaned:HDI_VH | reg_fav_twoway_demeaned:HDI_ME + reg_fav_twoway_demeaned:HDI_HI + reg_fav_twoway_demeaned:HDI_VH"
        cluster1_col: "subdivisions"
        cluster2_col: "year"

      ## DEBUG

      debug_modis_ntlharm_regfav:
        description: "2SLS: Growth effect on temperature using regional favoritism as instrument"
        data_source: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/data_nobackup/assembled/modis_subset.parquet"
        formula: "median_twoway_demeaned ~ ntl_harm_twoway_demeaned | reg_fav_twoway_demeaned"
        cluster1_col: "subdivisions"
        cluster2_col: "year"
        module: "gnt.analysis.streamreg"
        class: "iv"
        settings:
          verbose: true

# Output settings
output:
  base_path: "/scicore/home/meiera/schulz0022/projects/growth-and-temperature/output/analysis"
  formats: ["json"]
  
# HPC settings for analysis
hpc:
  default_workers: 4
  memory_limit: "32GB"
  temp_dir: "/tmp"
  dashboard_port: 8788